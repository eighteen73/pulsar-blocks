{"version":3,"file":"menu/view.js","mappings":"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","sources":["webpack://pulsar-blocks/external module \"@wordpress/interactivity\"","webpack://pulsar-blocks/webpack/bootstrap","webpack://pulsar-blocks/webpack/runtime/make namespace object","webpack://pulsar-blocks/./src/menu/view.js"],"sourcesContent":["module.exports = __WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { store, getContext, getElement } from '@wordpress/interactivity';\n\n// Reusable list of focusable elements selector\nconst focusableSelectors = [\n\t'a[href]',\n\t'input:not([disabled]):not([type=\"hidden\"]):not([aria-hidden])',\n\t'select:not([disabled]):not([aria-hidden])',\n\t'textarea:not([disabled]):not([aria-hidden])',\n\t'button:not([disabled]):not([aria-hidden])',\n\t'[contenteditable]',\n\t'[tabindex]:not([tabindex^=\"-\"])',\n];\n\n// Define the breakpoint\nconst MOBILE_BREAKPOINT = '(max-width: 1024px)';\n\n// --- Helper function to get owner document ---\n// Avoids repeating the logic in multiple places\nfunction getOwnerDocument(elementRef) {\n\treturn elementRef?.ownerDocument ?? document;\n}\n\nstore('pulsar/menu', {\n\tstate: {\n\t\t// State managed at the root level for the main mobile menu toggle\n\t\tisMobileMenuOpen: false,\n\t\t// NEW: State to track responsive view\n\t\tisMobileView: window.matchMedia(MOBILE_BREAKPOINT).matches,\n\t\t// We'll store references needed for focus management here\n\t\tmobileMenuElement: null,\n\t\tfirstFocusableElement: null,\n\t\tlastFocusableElement: null,\n\t\tpreviousFocus: null, // Element that triggered the mobile menu open\n\t},\n\tactions: {\n\t\t// --- Mobile Menu Actions ---\n\t\ttoggleMobileMenu: () => {\n\t\t\tconst { state, actions } = store('pulsar/menu');\n\t\t\tconst { ref: toggleButton } = getElement();\n\t\t\tconst ownerDoc = getOwnerDocument(toggleButton);\n\n\t\t\tstate.isMobileMenuOpen = !state.isMobileMenuOpen;\n\t\t\t// Class toggling will be handled by data-wp-class in render.php\n\n\t\t\tif (state.isMobileMenuOpen) {\n\t\t\t\tstate.previousFocus = ownerDoc.activeElement;\n\t\t\t\townerDoc.documentElement.classList.add('has-menu-open');\n\t\t\t\t// Focus first element when menu opens (might need slight delay)\n\t\t\t\t// We rely on initMobileMenu now primarily\n\t\t\t} else {\n\t\t\t\townerDoc.documentElement.classList.remove('has-menu-open');\n\t\t\t\tif (state.previousFocus && state.previousFocus.focus) {\n\t\t\t\t\tstate.previousFocus.focus();\n\t\t\t\t}\n\t\t\t\tactions.clearMobileMenuFocusData();\n\t\t\t}\n\t\t},\n\t\tcloseMobileMenu: () => {\n\t\t\tconst { state, actions } = store('pulsar/menu');\n\t\t\tif (state.isMobileMenuOpen) {\n\t\t\t\t// Directly set state to false instead of calling toggle,\n\t\t\t\t// avoids potential race conditions if called rapidly.\n\t\t\t\tstate.isMobileMenuOpen = false;\n\n\t\t\t\tconst { ref: closeButton } = getElement(); // Assumes called from close button context\n\t\t\t\tconst ownerDoc = getOwnerDocument(closeButton);\n\t\t\t\townerDoc.documentElement.classList.remove('has-menu-open');\n\t\t\t\tif (state.previousFocus && state.previousFocus.focus) {\n\t\t\t\t\tstate.previousFocus.focus();\n\t\t\t\t}\n\t\t\t\tactions.clearMobileMenuFocusData();\n\t\t\t}\n\t\t},\n\t\tclearMobileMenuFocusData: () => {\n\t\t\tconst { state } = store('pulsar/menu');\n\t\t\tstate.mobileMenuElement = null;\n\t\t\tstate.firstFocusableElement = null;\n\t\t\tstate.lastFocusableElement = null;\n\t\t\tstate.previousFocus = null;\n\t\t},\n\t\thandleMobileMenuKeydown: (event) => {\n\t\t\tconst { state } = store('pulsar/menu');\n\t\t\tif (!state.isMobileMenuOpen) return;\n\t\t\tconst { actions } = store('pulsar/menu');\n\t\t\tconst { ref: mobileMenuContainer } = getElement();\n\t\t\tconst ownerDoc = getOwnerDocument(mobileMenuContainer);\n\n\t\t\t// Close on Escape\n\t\t\tif (event.key === 'Escape') {\n\t\t\t\tevent.stopPropagation(); // Still important to prevent bubbling\n\t\t\t\tactions.closeMobileMenu();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Trap Tab focus\n\t\t\tif (event.key === 'Tab') {\n\t\t\t\tconst { firstFocusableElement, lastFocusableElement } = state;\n\t\t\t\t// Ensure elements are found before trapping\n\t\t\t\tif (!firstFocusableElement || !lastFocusableElement) {\n\t\t\t\t\t// Attempt to find them now if they weren't ready during init\n\t\t\t\t\tif (state.mobileMenuElement) {\n\t\t\t\t\t\tconst focusableElements =\n\t\t\t\t\t\t\tstate.mobileMenuElement.querySelectorAll(\n\t\t\t\t\t\t\t\tfocusableSelectors.join(',')\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tif (focusableElements.length) {\n\t\t\t\t\t\t\tstate.firstFocusableElement = focusableElements[0];\n\t\t\t\t\t\t\tstate.lastFocusableElement =\n\t\t\t\t\t\t\t\tfocusableElements[focusableElements.length - 1];\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t// If still not found, exit tab trapping logic\n\t\t\t\t\tif (\n\t\t\t\t\t\t!state.firstFocusableElement ||\n\t\t\t\t\t\t!state.lastFocusableElement\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Use ownerDoc.activeElement\n\t\t\t\tif (\n\t\t\t\t\tevent.shiftKey &&\n\t\t\t\t\townerDoc.activeElement === firstFocusableElement\n\t\t\t\t) {\n\t\t\t\t\t// Shift + Tab on first element -> loop to last\n\t\t\t\t\tevent.preventDefault(); // Still needed to prevent default tab behavior\n\t\t\t\t\tlastFocusableElement.focus();\n\t\t\t\t} else if (\n\t\t\t\t\t!event.shiftKey &&\n\t\t\t\t\townerDoc.activeElement === lastFocusableElement\n\t\t\t\t) {\n\t\t\t\t\t// Tab on last element -> loop to first\n\t\t\t\t\tevent.preventDefault(); // Still needed\n\t\t\t\t\tfirstFocusableElement.focus();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\thandleMobileMenuFocusout: () => {\n\t\t\tconst { state, actions } = store('pulsar/menu');\n\t\t\tconst { ref: mobileMenuContainer } = getElement();\n\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tif (\n\t\t\t\t\tstate.isMobileMenuOpen &&\n\t\t\t\t\tstate.mobileMenuElement &&\n\t\t\t\t\t!state.mobileMenuElement.contains(\n\t\t\t\t\t\tgetOwnerDocument(mobileMenuContainer).activeElement\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tactions.closeMobileMenu();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t// --- Submenu Actions ---\n\t\t// Toggle now primarily manages state for aria and class binding\n\t\ttoggleSubmenu: () => {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isSubmenuOpen = !context.isSubmenuOpen;\n\t\t},\n\t\topenSubmenu: () => {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isSubmenuOpen = true;\n\t\t},\n\t\tcloseSubmenu: () => {\n\t\t\tconst context = getContext();\n\t\t\tcontext.isSubmenuOpen = false;\n\t\t},\n\t\topenSubmenuOnHover: () => {\n\t\t\tconst { state } = store('pulsar/menu');\n\t\t\tif (state.isMobileView) return;\n\t\t\tconst context = getContext();\n\t\t\tcontext.isSubmenuOpen = true;\n\t\t},\n\t\tcloseSubmenuOnHover: () => {\n\t\t\tconst { state } = store('pulsar/menu');\n\t\t\tif (state.isMobileView) return;\n\t\t\tconst context = getContext();\n\t\t\tconst { ref } = getElement();\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (ref && !ref.matches(':hover')) {\n\t\t\t\t\tcontext.isSubmenuOpen = false;\n\t\t\t\t}\n\t\t\t}, 100);\n\t\t},\n\t\thandleSubmenuKeydown: (event) => {\n\t\t\tconst context = getContext();\n\t\t\tif (!context.isSubmenuOpen) return;\n\t\t\tconst { actions } = store('pulsar/menu');\n\n\t\t\tif (event.key === 'Escape') {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\tactions.closeSubmenu();\n\t\t\t\tconst { ref } = getElement();\n\t\t\t\tconst parentLi = ref.closest('li.wp-block-pulsar-menu__item');\n\t\t\t\tconst toggleButton = parentLi?.querySelector(\n\t\t\t\t\t'.wp-block-pulsar-menu__submenu-icon'\n\t\t\t\t);\n\t\t\t\ttoggleButton?.focus();\n\t\t\t}\n\t\t},\n\t\thandleSubmenuFocusout: () => {\n\t\t\tconst context = getContext();\n\t\t\tconst { ref } = getElement();\n\t\t\tconst { actions } = store('pulsar/menu');\n\n\t\t\trequestAnimationFrame(() => {\n\t\t\t\tif (\n\t\t\t\t\tcontext.isSubmenuOpen &&\n\t\t\t\t\tref &&\n\t\t\t\t\t!ref.contains(getOwnerDocument(ref).activeElement)\n\t\t\t\t) {\n\t\t\t\t\tactions.closeSubmenu();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t// --- Responsive Actions ---\n\t\t_updateIsMobileView: (matches) => {\n\t\t\tconst { state, actions } = store('pulsar/menu');\n\t\t\tconst previousIsMobileView = state.isMobileView;\n\t\t\tstate.isMobileView = matches;\n\n\t\t\t// If switching to desktop view\n\t\t\tif (!matches) {\n\t\t\t\t// If mobile menu was open, close it cleanly\n\t\t\t\tif (state.isMobileMenuOpen) {\n\t\t\t\t\tactions.closeMobileMenu();\n\t\t\t\t}\n\t\t\t\t// Optional: Close all open submenus when switching to desktop?\n\t\t\t\t// This would require iterating through elements or contexts.\n\t\t\t}\n\t\t\t// If switching TO mobile view\n\t\t\telse if (matches && !previousIsMobileView) {\n\t\t\t\t// Optional: Close all open submenus when switching to mobile?\n\t\t\t}\n\t\t},\n\t},\n\tcallbacks: {\n\t\t// --- Mobile Menu Callbacks ---\n\t\tinitMobileMenu: () => {\n\t\t\tconst { state } = store('pulsar/menu');\n\t\t\tconst { ref } = getElement();\n\t\t\tstate.mobileMenuElement = ref;\n\t\t\t// Find focusable elements only if menu is currently open on init\n\t\t\tif (state.isMobileMenuOpen) {\n\t\t\t\tconst focusableElements = ref.querySelectorAll(\n\t\t\t\t\tfocusableSelectors.join(',')\n\t\t\t\t);\n\t\t\t\tif (focusableElements.length) {\n\t\t\t\t\tstate.firstFocusableElement = focusableElements[0];\n\t\t\t\t\tstate.lastFocusableElement =\n\t\t\t\t\t\tfocusableElements[focusableElements.length - 1];\n\t\t\t\t\tstate.firstFocusableElement.focus(); // Focus now it's definitely open\n\t\t\t\t} else {\n\t\t\t\t\tstate.firstFocusableElement = null;\n\t\t\t\t\tstate.lastFocusableElement = null;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// --- Root Nav Callbacks ---\n\t\tinitNav: () => {\n\t\t\tconst { actions } = store('pulsar/menu');\n\t\t\tconst mediaQuery = window.matchMedia(MOBILE_BREAKPOINT);\n\n\t\t\t// Initial check\n\t\t\tactions._updateIsMobileView(mediaQuery.matches);\n\n\t\t\t// Listener for changes\n\t\t\t// Using 'change' event is preferred over 'resize' for matchMedia\n\t\t\tconst changeHandler = (event) => {\n\t\t\t\tactions._updateIsMobileView(event.matches);\n\t\t\t};\n\t\t\tmediaQuery.addEventListener('change', changeHandler);\n\n\t\t\t// Return cleanup function to remove listener\n\t\t\treturn () => {\n\t\t\t\tmediaQuery.removeEventListener('change', changeHandler);\n\t\t\t};\n\t\t},\n\t},\n});\n\n// Define requestAnimationFrame if not globally available\nconst requestAnimationFrame =\n\twindow.requestAnimationFrame ||\n\t((callback) => window.setTimeout(callback, 1000 / 60));\n"],"names":["store","getContext","getElement","focusableSelectors","MOBILE_BREAKPOINT","getOwnerDocument","elementRef","_elementRef$ownerDocu","ownerDocument","document","state","isMobileMenuOpen","isMobileView","window","matchMedia","matches","mobileMenuElement","firstFocusableElement","lastFocusableElement","previousFocus","actions","toggleMobileMenu","ref","toggleButton","ownerDoc","activeElement","documentElement","classList","add","remove","focus","clearMobileMenuFocusData","closeMobileMenu","closeButton","handleMobileMenuKeydown","event","mobileMenuContainer","key","stopPropagation","focusableElements","querySelectorAll","join","length","shiftKey","preventDefault","handleMobileMenuFocusout","requestAnimationFrame","contains","toggleSubmenu","context","isSubmenuOpen","openSubmenu","closeSubmenu","openSubmenuOnHover","closeSubmenuOnHover","setTimeout","handleSubmenuKeydown","parentLi","closest","querySelector","handleSubmenuFocusout","_updateIsMobileView","previousIsMobileView","callbacks","initMobileMenu","initNav","mediaQuery","changeHandler","addEventListener","removeEventListener","callback"],"sourceRoot":""}