import*as e from"@wordpress/interactivity";var t={d:(e,s)=>{for(var o in s)t.o(s,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:s[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const s=(o={getContext:()=>e.getContext,getElement:()=>e.getElement,store:()=>e.store},i={},t.d(i,o),i);var o,i;class a{constructor({targetModal:e,modalElement:t,triggers:s=[],dismissedDuration:o,disableClosing:i=!1,portalContainerId:a,openTrigger:l="data-trigger-modal",closeTrigger:r="data-modal-close",openClass:n="is-open",bodyOpenClass:d="modal-is-open",focusFirstNode:c=!0,focusableElements:h='a[href],area[href],input:not([disabled]):not([type="hidden"]):not([aria-hidden]),select:not([disabled]):not([aria-hidden]),textarea:not([disabled]):not([aria-hidden]),button:not([disabled]):not([aria-hidden]),iframe,object,embed,[contenteditable],[tabindex]:not([tabindex^="-"])',storageKeyPrefix:g="pulsar_modal_",escKeyCode:p=27,tabKeyCode:u=9,modalSelector:m="data-modal-id",overlayClass:f="wp-block-pulsar-modal",overlayOverlayClass:w="wp-block-pulsar-modal__overlay"}){this.modalId=e,this.dismissedDuration=o,this.disableClosing=i,this.openTrigger=l,this.closeTrigger=r,this.openClass=n,this.bodyOpenClass=d,this.focusFirstNode=c,this.focusableElements=h,this.storageKeyPrefix=g,this.escKeyCode=p,this.tabKeyCode=u,this.modalSelector=m,this.overlayClass=f,this.overlayOverlayClass=w,this.closeTriggerType=r.startsWith("data-")?"data":"class",this.modal=t||document.querySelector(`[${this.modalSelector}="${this.modalId}"]`),this.modal&&(this.originalParent=this.modal.parentNode,this.portalContainer=document.getElementById(a),s.length>0&&this.registerTriggers(...s),this.onClick=this.onClick.bind(this),this.onKeydown=this.onKeydown.bind(this))}modal;modalId;openTrigger;closeTrigger;closeTriggerType;openClass;bodyOpenClass;dismissedDuration=0;disableClosing=!1;activeElement;focusFirstNode;focusableElements;storageKeyPrefix;escKeyCode;tabKeyCode;modalSelector;overlayClass;overlayOverlayClass;isCloseTrigger(e){return!!e&&("data"===this.closeTriggerType?e.hasAttribute(this.closeTrigger)||e.parentNode&&e.parentNode.hasAttribute(this.closeTrigger):e.classList.contains(this.closeTrigger)||e.parentNode&&e.parentNode.classList.contains(this.closeTrigger))}registerTriggers(...e){e.filter(Boolean).forEach((e=>{e.addEventListener("click",(e=>{("A"===e.target.tagName||e.target.closest("a"))&&!this.modal.classList.contains(this.openClass)&&(e.preventDefault(),e.stopPropagation()),this.showModal(!0)})),e.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),this.showModal(!0))}))}))}setStorage(){const e=(new Date).getTime()+60*this.dismissedDuration*1e3;window.localStorage.setItem(this.storageKeyPrefix+this.modalId,e)}getStorage(){const e=window.localStorage.getItem(this.storageKeyPrefix+this.modalId);return!!(e&&(new Date).getTime()<e)}showModal(e=!1){this.dismissedDuration&&this.getStorage()&&!1===e||(this.activeElement=this.modal.ownerDocument.activeElement,this.moveToPortal(),this.modal.classList.add(this.openClass),document.body.classList.add(this.bodyOpenClass),this.updateAriaExpanded("true"),this.addEventListeners(),this.focusFirstNode&&this.setFocusToFirstNode())}closeModal(){this.disableClosing||(this.removeEventListeners(),this.activeElement&&this.activeElement.focus&&this.activeElement.focus(),this.modal.classList.remove(this.openClass),document.body.classList.remove(this.bodyOpenClass),this.updateAriaExpanded("false"),this.restoreToOriginalParent(),this.dismissedDuration&&this.setStorage(),window.dispatchEvent(new CustomEvent("pulsar-modal-closed",{detail:this.modalId})))}moveToPortal(){this.portalContainer&&this.modal.parentNode!==this.portalContainer&&this.portalContainer.appendChild(this.modal)}restoreToOriginalParent(){this.originalParent&&this.modal.parentNode===this.portalContainer&&this.originalParent.appendChild(this.modal)}addEventListeners(){this.modal.addEventListener("touchstart",this.onClick),this.modal.addEventListener("click",this.onClick),document.addEventListener("keydown",this.onKeydown)}removeEventListeners(){this.modal.removeEventListener("touchstart",this.onClick),this.modal.removeEventListener("click",this.onClick),document.removeEventListener("keydown",this.onKeydown)}onClick(e){if(this.disableClosing){const t=this.isCloseTrigger(e.target),s=e.target.classList.contains(this.overlayClass)||e.target.classList.contains(this.overlayOverlayClass);if(t||s)return e.preventDefault(),void e.stopPropagation()}(this.isCloseTrigger(e.target)||e.target.classList.contains(this.overlayClass)||e.target.classList.contains(this.overlayOverlayClass))&&(e.preventDefault(),e.stopPropagation(),this.closeModal(e))}updateAriaExpanded(e){document.querySelectorAll(`[${this.openTrigger}="${this.modalId}"]`).forEach((t=>{t.setAttribute("aria-expanded",e)}))}onKeydown(e){this.disableClosing&&e.keyCode===this.escKeyCode?e.preventDefault():(e.keyCode===this.escKeyCode&&this.closeModal(e),e.keyCode===this.tabKeyCode&&this.retainFocus(e))}getFocusableNodes(){const e=this.modal.querySelectorAll(this.focusableElements);return Array.from(e)}setFocusToFirstNode(){const e=this.getFocusableNodes();if(0===e.length)return;const t=e.filter((e=>!this.isCloseTrigger(e)));t.length>0&&t[0].focus(),0===t.length&&e[0].focus()}setFocusToNode(e){e&&e.focus()}retainFocus(e){let t=this.getFocusableNodes();if(0===t.length)return;t=t.filter((e=>null!==e.offsetParent));const s=t.indexOf(this.modal.ownerDocument.activeElement);e.shiftKey&&0===s&&(t[t.length-1].focus(),e.preventDefault()),!e.shiftKey&&t.length>0&&s===t.length-1&&(t[0].focus(),e.preventDefault())}}window.pulsarBlocks=window.pulsarBlocks||{},window.pulsarBlocks.facetwpFilters=window.pulsarBlocks.facetwpFilters||new Map,(0,s.store)("pulsar/facetwp-filters",{actions:{openModal:()=>{const e=(0,s.getContext)(),t=window.pulsarBlocks.facetwpFilters.get(e.filtersModalId);t&&t.showModal(!0)},closeModal:()=>{const e=(0,s.getContext)(),t=window.pulsarBlocks.facetwpFilters.get(e.filtersModalId);t&&t.closeModal()},toggleFilter:()=>{const e=(0,s.getContext)(),{openFilters:t,filterId:o}=e;if(t.includes(o))return void(e.openFilters=t.filter((e=>e!==o)));const{ref:i}=(0,s.getElement)(),{filtersLayout:a,filtersModalId:l}=e,r=!!i.closest(".wp-block-pulsar-facetwp-filters__items"),n=("dropdowns"===a||"slide-out"===a)&&r;if(e.openFilters=n?[o]:[...t,o],"slide-out"===a&&r){const e=window.pulsarBlocks.facetwpFilters.get(l);if(e){e.showModal(!0);const t=e.modal.querySelector(`[data-filter-id="${o}"] .wp-block-pulsar-facetwp-filter__title`);e.setFocusToNode(t)}}},resetFilters:()=>{window.FWP&&window.FWP.reset()},onModalClose:e=>{const t=(0,s.getContext)();e.detail===t.filtersModalId&&(t.openFilters=[])},updateFilterCount:()=>{const e=(0,s.getContext)();let t=0;const o=["pager","sort","reset"];window.FWP.facets&&Object.entries(window.FWP.facets).forEach((([e,s])=>{const i=window.FWP.facet_type?.[e];!o.includes(i)&&s.length>0&&(t+=s.length)})),e.appliedFilterCount=t},handleKeydown:e=>{const t=(0,s.getContext)(),{actions:o}=(0,s.store)("pulsar/facetwp-filters"),{openFilters:i,filterId:a}=t;i.includes(a)&&"Escape"===e.key&&o.toggleFilter()},handleClickOutside:e=>{const t=(0,s.getContext)(),{ref:o}=(0,s.getElement)(),{openFilters:i,filtersLayout:a}=t,l=o.querySelector(".wp-block-pulsar-facetwp-filters__items");"dropdowns"===a&&0!==i.length&&l&&!l.contains(e.target)&&(t.openFilters=[])}},callbacks:{init:()=>{const{actions:e}=(0,s.store)("pulsar/facetwp-filters"),t=(0,s.getContext)(),{filtersModalId:o}=t,{ref:i}=(0,s.getElement)(),l=i.querySelector(`[data-modal-id="${o}"]`);if(!window.pulsarBlocks.facetwpFilters.has(o)&&l){const e={targetModal:o,modalElement:l,focusFirstNode:!0,closeTrigger:"data-modal-close",openClass:"is-open",containerClass:"wp-block-pulsar-facetwp-filters__modal-container",overlayClass:"wp-block-pulsar-facetwp-filters__modal-overlay"};window.pulsarBlocks.facetwpFilters.set(o,new a(e))}e.updateFilterCount()},isActiveFilter:()=>{const e=(0,s.getContext)(),{openFilters:t,filterId:o}=e;return t.includes(o)}}});