(()=>{"use strict";class e{constructor({targetModal:e,triggers:t=[],dismissedDuration:s}){this.modalId=e,this.dismissedDuration=s,this.modal=document.querySelector(`[data-modal-id="${this.modalId}"]`),t.length>0&&this.registerTriggers(...t),this.modal.removeAttribute("data-modal-trigger-delay"),this.modal.removeAttribute("data-modal-trigger-selector"),this.modal.removeAttribute("data-modal-dismissed-duration"),this.onClick=this.onClick.bind(this),this.onKeydown=this.onKeydown.bind(this)}modal;modalId;openTrigger="data-trigger-modal";closeTrigger="wp-block-pulsar-modal__close";openClass="is-open";dismissedDuration=0;activeElement;focusableElements='a[href],area[href],input:not([disabled]):not([type="hidden"]):not([aria-hidden]),select:not([disabled]):not([aria-hidden]),textarea:not([disabled]):not([aria-hidden]),button:not([disabled]):not([aria-hidden]),iframe,object,embed,[contenteditable],[tabindex]:not([tabindex^="-"])';registerTriggers(...e){e.filter(Boolean).forEach((e=>{e.addEventListener("click",(e=>{("A"===e.target.tagName||e.target.closest("a"))&&!this.modal.classList.contains(this.openClass)&&(e.preventDefault(),e.stopPropagation()),this.showModal(!0)}))}))}setStorage(){const e=(new Date).getTime()+60*this.dismissedDuration*1e3;window.localStorage.setItem("pulsar_modal_"+this.modalId,e)}getStorage(){const e=window.localStorage.getItem("pulsar_modal_"+this.modalId);return!!(e&&(new Date).getTime()<e)}showModal(e=!1){this.dismissedDuration&&this.getStorage()&&!1===e||(this.activeElement=this.modal.ownerDocument.activeElement,this.modal.classList.add(this.openClass),this.addEventListeners(),this.setFocusToFirstNode())}closeModal(){const e=this.modal;this.removeEventListeners(),this.activeElement&&this.activeElement.focus&&this.activeElement.focus(),e.classList.remove(this.openClass),this.dismissedDuration&&this.setStorage()}addEventListeners(){this.modal.addEventListener("touchstart",this.onClick),this.modal.addEventListener("click",this.onClick),document.addEventListener("keydown",this.onKeydown)}removeEventListeners(){this.modal.removeEventListener("touchstart",this.onClick),this.modal.removeEventListener("click",this.onClick),document.removeEventListener("keydown",this.onKeydown)}onClick(e){(e.target.classList.contains(this.closeTrigger)||e.target.parentNode.classList.contains(this.closeTrigger)||e.target.classList.contains("wp-block-pulsar-modal")||e.target.classList.contains("wp-block-pulsar-modal__overlay"))&&(e.preventDefault(),e.stopPropagation(),this.closeModal(e))}onKeydown(e){27===e.keyCode&&this.closeModal(e),9===e.keyCode&&this.retainFocus(e)}getFocusableNodes(){const e=this.modal.querySelectorAll(this.focusableElements);return Array.from(e)}setFocusToFirstNode(){const e=this.getFocusableNodes();if(0===e.length)return;const t=e.filter((e=>!e.classList.contains(this.closeTrigger)));t.length>0&&t[0].focus(),0===t.length&&e[0].focus()}retainFocus(e){let t=this.getFocusableNodes();if(0===t.length)return;t=t.filter((e=>null!==e.offsetParent));const s=t.indexOf(this.modal.ownerDocument.activeElement);e.shiftKey&&0===s&&(t[t.length-1].focus(),e.preventDefault()),!e.shiftKey&&t.length>0&&s===t.length-1&&(t[0].focus(),e.preventDefault())}}window.addEventListener("DOMContentLoaded",(()=>{window.modalBlocks=new Map,document.querySelectorAll(".wp-block-pulsar-modal").forEach((t=>{const s=t.getAttribute("data-modal-id"),o=t.getAttribute("data-modal-trigger-selector"),i=parseInt(t.getAttribute("data-modal-trigger-delay")),a=t.getAttribute("data-modal-dismissed-duration")||0,n=a.toString().replace(/\d+/g,"");let r=a;if(n)switch(n){case"mins":r=parseInt(a);break;case"hrs":r=60*parseInt(a);break;case"days":r=1440*parseInt(a);break;default:console.warn(`Unknown dismissed unit: ${n}`)}const d=Object.assign({},{openTrigger:"data-trigger-modal"}),l=[...document.querySelectorAll(`[${d.openTrigger}="${s}"]`),...o?document.querySelectorAll(`${o}`):[]];d.targetModal=s,d.triggers=l,d.dismissedDuration=r,window.modalBlocks.set(s,new e(d)),null===i||isNaN(i)||setTimeout((()=>window.modalBlocks.get(s).showModal()),i)}))}))})();